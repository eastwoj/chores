<div class="min-h-screen bg-gray-50">
  <!-- Header -->
  <div class="bg-white shadow-sm border-b border-gray-200">
    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
      <div class="flex justify-between items-center py-6">
        <div>
          <h1 class="text-3xl font-bold text-gray-900">
            Pay Period History
          </h1>
          <p class="text-gray-600 mt-1">
            Complete history of all pay periods and payouts
          </p>
        </div>
        
        <div class="flex items-center space-x-4">
          <%= link_to admin_root_path, 
                      class: "text-gray-600 hover:text-gray-900 font-medium" do %>
            ‚Üê Back to Dashboard
          <% end %>
        </div>
      </div>
    </div>
  </div>

  <!-- Main Content -->
  <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
    <% if @pay_periods.any? %>
      <div class="space-y-6">
        <% @pay_periods.each do |period| %>
          <% detailed_earnings = @detailed_earnings_by_period[period.id] %>
          <div class="bg-white rounded-xl shadow-sm border border-gray-200 p-6">
            <div class="flex items-center justify-between mb-4">
              <div>
                <h3 class="text-xl font-bold text-gray-900">
                  <%= period.start_date.strftime("%B %d") %> - <%= period.end_date.strftime("%B %d, %Y") %>
                </h3>
                <div class="flex items-center space-x-4 mt-1">
                  <span class="text-sm text-gray-500">
                    <%= period.frequency_description %>
                  </span>
                  <span class="text-sm <%= period.current_period? ? 'text-blue-600' : 'text-gray-500' %>">
                    <%= period.current_period? ? 'Current Period' : 'Completed' %>
                  </span>
                  <% if period.last_payout_at %>
                    <span class="text-sm text-green-600">
                      Paid out <%= period.last_payout_at.strftime("%m/%d/%y") %>
                    </span>
                  <% end %>
                </div>
              </div>
              
              <div class="text-right">
                <p class="text-2xl font-bold text-green-600">
                  $<%= sprintf("%.2f", period.total_earnings_for_period) %>
                </p>
                <p class="text-sm text-gray-500 mb-2">Total</p>
                
                <% if period.current_period? %>
                  <%= form_with url: complete_admin_pay_period_path(period), 
                                method: :patch, 
                                local: true, 
                                class: "inline-block" do %>
                    <button type="submit" 
                            class="bg-blue-500 text-white px-3 py-1 text-sm rounded hover:bg-blue-600 transition-colors"
                            onclick="return confirm('This will end the current pay period and start a new one. No payout will be processed. Are you sure?')">
                      Mark Complete
                    </button>
                  <% end %>
                <% end %>
              </div>
            </div>
            
            <% if detailed_earnings&.any? %>
              <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                <% detailed_earnings.each do |child_id, earnings| %>
                  <div class="bg-gray-50 rounded-lg p-4">
                    <div class="flex items-center justify-between mb-3">
                      <h4 class="font-medium text-gray-900"><%= earnings[:child].name %></h4>
                      <p class="text-lg font-bold text-green-600">$<%= sprintf("%.2f", earnings[:total]) %></p>
                    </div>
                    
                    <div class="space-y-2 text-sm">
                      <% if earnings[:completed_chores].any? %>
                        <div>
                          <p class="font-medium text-gray-700">Chores ($<%= sprintf("%.2f", earnings[:chore_earnings]) %>):</p>
                          <ul class="ml-4 space-y-1 max-h-32 overflow-y-auto">
                            <% earnings[:completed_chores].each do |chore_data| %>
                              <li class="text-gray-600">
                                <%= chore_data[:chore].title %> 
                                <span class="text-green-600">+$<%= sprintf("%.2f", chore_data[:amount]) %></span>
                                <span class="text-gray-400">
                                  (<%= chore_data[:completed_at]&.strftime("%m/%d") %>)
                                </span>
                              </li>
                            <% end %>
                          </ul>
                        </div>
                      <% end %>
                      
                      <% if earnings[:completed_extras].any? %>
                        <div>
                          <p class="font-medium text-gray-700">Extras ($<%= sprintf("%.2f", earnings[:extra_earnings]) %>):</p>
                          <ul class="ml-4 space-y-1 max-h-32 overflow-y-auto">
                            <% earnings[:completed_extras].each do |extra_data| %>
                              <li class="text-gray-600">
                                <%= extra_data[:extra].title %>
                                <span class="text-green-600">+$<%= sprintf("%.2f", extra_data[:amount]) %></span>
                                <span class="text-gray-400">
                                  (<%= extra_data[:completed_at]&.strftime("%m/%d") %>)
                                </span>
                              </li>
                            <% end %>
                          </ul>
                        </div>
                      <% end %>
                      
                      <% if earnings[:completed_chores].empty? && earnings[:completed_extras].empty? %>
                        <p class="text-gray-500 italic">No earnings this period</p>
                      <% end %>
                    </div>
                  </div>
                <% end %>
              </div>
            <% else %>
              <p class="text-gray-500 text-center py-4">No earnings recorded for this period</p>
            <% end %>
          </div>
        <% end %>
      </div>
      
      <% if @pay_periods.count >= 20 %>
        <div class="text-center mt-8">
          <p class="text-gray-500">Showing most recent 20 pay periods</p>
        </div>
      <% end %>
      
    <% else %>
      <div class="bg-white rounded-xl shadow-sm border border-gray-200 p-6">
        <div class="text-center py-8">
          <h3 class="text-lg font-medium text-gray-900 mb-2">No Pay Periods Yet</h3>
          <p class="text-gray-500">
            Pay periods will appear here once children start completing chores and earning money.
          </p>
        </div>
      </div>
    <% end %>
  </div>
</div>